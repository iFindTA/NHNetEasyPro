<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
	<title>模板</title>
	<link href="main.css" rel="stylesheet">
	<script src="dot.js"></script>
    <script type="text/javascript" src="core.js"></script>
</head>
<body>
    <div id="builder"></div>
    <script type="text/javascript">
    	function connectWebViewJavascriptBridge(callback) {
	        if (window.WebViewJavascriptBridge) {
	         	callback(WebViewJavascriptBridge)
	        } else {
	          	document.addEventListener('WebViewJavascriptBridgeReady', function() {
                    callback(WebViewJavascriptBridge)
                    }, false)
	        }
	    }
	    // 这2句是必须写的
	    connectWebViewJavascriptBridge(function(bridge) {
            bridge.init(function(message, responseCallback) {
                console.log('JS got a message', message);
                var data = {
                        'Javascript Responds': 'Wee!'
                        };
                console.log('JS responding with', data);
                responseCallback(data);
            });
                                       
            bridge.registerHandler("functionInJs", function(data, responseCallback) {
                var responseData = "Javascript Says Right back aka!";
                responseCallback(responseData);
            });
            
            bridge.registerHandler('buildHtmlHandler', function(data, responseCallback) {
                responseCallback(data);
                if(typeof data == 'string') {
                    data = eval('(' + data + ')');
                }
                var ctn = data.data;
                if(typeof ctn == 'string') {
                    ctn = eval('(' + data.data + ')');
                }
                loadScript(data.template, function() {
                    ctn.body = replaceImage(ctn.body, ctn.img, data.defaultimg, data.pict);
                    build(ctn);
                 })
            });
        })
    </script>
</body>
</html>